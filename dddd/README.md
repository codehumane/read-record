# 책 소개

- [도메인 주도 설계 핵심<sup>Domain-Driven Design Distilled</sup>](http://acornpub.co.kr/book/domain-driven-design-distilled)
- 반 버논<sup>Vaughn Vernon</sup>
- 이전 책에 비해 핵심 내용만을 간추려 설명. 전술적 설계에 초점을 두고 있음.

# 나에게 도메인 주도 설계는

> 여러분이 만든 소프트웨어를 이용해 비즈니스가 새로운 차원에서 경쟁하게 만들고 싶을 것이다.

비즈니스가 계속 변화하고 커질 수 있도록 돕고 싶은 것이 목표. DDD는 이를 위한 하나의 수단. DDD 그 자체가 목적이 아님. 그리고 개인적으로 많은 도움을 받음. 적어도 아직까지는 좋은 도구라 생각. 물론, 개인의 역량과 더불어 환경 또한 중요한 기반 요소.

# 도메인 이벤트와 전술적 설계

## 도메인 이벤트

- 바운디드 컨텍스트 내의 비즈니스 관점에서 중요한 사항들에 대한 기록
- 전략적 설계를 위한 중요한 도구

## 인과관계 일관성

아래는 오퍼레이션의 인과관계를 나타냄.

1. 수가 `내 지갑을 잃어버렸어!`라는 메시지를 보낸다.
2. 개리가 그 메시지에 `큰일났네!`라고 답한다.
3. 수가 `걱정마, 지갑을 찾았어!`라고 메시지를 보낸다.
4. 개리가 `잘됐다!`라고 답장을 보낸다.

분산된 시스템에서 이벤트를 사용할 경우, 오퍼레이션이 전달되는 순서는 보장되지 않을 수 있음. 이 때, 인과관계를 보장하지 못하면, `내 지갑을 잃어버렸어!`라는 메시지에 `잘됐다!`라는 답장이 전달될 수 있음.

## 도메인 이벤트 설계

### 네이밍

도메인 모델의 보편언어를 반영. 모델 안에서 발생하는 사건과 모델 밖을 이어주는 다리. 원활한 의사소통에 도움.

아래는 예시.

- `ProductCreated`
- `ReleaseScheduled`
- `SprintScheduled`
- `BacklogItemPlanned`
- `BacklogItemCommitted`

### 속성

`OccurredOn`을 기본적으로 포함하길 권장함. 유용하게 쓰이는 상황이 자주 있음.

```c#
public interface DomainEvent
{
  public Date OccurredOn
  {
    get;
  }
}
```

명령이 제공하는 모든 프로퍼티를 담고 있어야 함.

- 이벤트 구독자들에게 모델 안에서 무슨 일이 벌어졌는지를 온전히 알릴 수 있음.
- 예컨대, `CreateProduct`라는 커맨드에 `tenantId`, `productId`, `name`, `description`이 있었다면,
- `ProductCreated`라는 이벤트에도 이 속성들이 담김.

도메인 이벤트에 풍부한 추가 데이터를 담을 수 있음.

- 구독자가 추가 데이터를 얻기 위해 쿼리를 다시 날리지 않아도 됨.
- 그러나 의미를 잃을 정도로 너무 많은 데이터를 담지는 않아야 함.
- 또한, `BacklogItemUpdated`에 `BacklogItem`의 전체 상태를 보낼 경우,
- 어떤 변경이 있었는지 알기 위해 이전의 `BacklogItemUpdated`와 비교해야 하는 부담이 있을 수도 있음.

### 영속

아래 내용을 읽고 잠시 의문이 생겼으나,

> 어느 쪽이든, 도메인 이벤트를 이벤트 리파지토리에 유지하는 것은 도메인 모델 간에 발생한 것에 대한 인과관계의 순서를 지속시켜준다.

뒤이어 바로 잡아줌.

> 다만, 도메인 이벤트를 인과관계의 순서에 따라 저장하는 것이 같은 요청 내에 분산돼 있는 다른 노드들에 도달할 것을 보장하는 것은 아니다. 이에 따른 적절한 인과관계를 파악하는 것 또한 이를 소비하는 바운디드 컨텍스트가 가져야 할 책임이다.

### 발생자

누가 이벤트를 발생시키는가?

- 보통은 사용자 인터페이스에 의해 발현되는 사용자 기반 명령.
- 때로는 시간 만료와 같은 이벤트. 이 때는 이벤트를 발생시키는 명령이 존재하지 않음.

